jQuery(document).ready(function(r){var t,n=wp.i18n.__,e=_tutor_chatgpt.bubble_position,c={bottom_right:"bottom_right",bottom_left:"bottom_left",top_right:"top_right",top_left:"top_left"},i=null,u=null,o="tooltip-left";switch(e){case c.bottom_left:case c.top_left:o="tooltip-right";break;case c.bottom_right:case c.top_right:o="tooltip-left"}var a='<div class="tutor-chatgpt-bubble tooltip-wrap">\n                        <span class="tooltip-txt '.concat(o,'">\n                            <div><span>Generate Content</span></div>\n                        </span>\n                      </div>');function s(t){var o=r("div.tutor-chatgpt-bubble");if(0!==o.length){var a=8;switch("tinymce"===t&&(a=r(i).find(".mce-toolbar-grp").eq(0).height()+8),e){case c.bottom_left:o.css("left","".concat(8,"px"));break;case c.top_left:o.css({top:"".concat(a,"px"),left:"".concat(8,"px")});break;case c.top_right:o.css({top:"".concat(a,"px"),right:"".concat(8,"px")})}}}function l(t){r("div.tutor-chatgpt-bubble").remove(),"DIV"===t.nodeName&&0===r(t).parent().find("div.tutor-chatgpt-bubble").length&&(r(t).parent().append(a),r("div.tutor-chatgpt-bubble").css("bottom","25px"),s("tinymce")),"TEXTAREA"===t.nodeName&&(!1===r(t).parent().is("div.tutor-chatgpt-wrapper")&&r(t).wrap('<div class="tutor-chatgpt-wrapper"></div>'),r(t).parent().append(a),s("textarea"))}function p(t){u=t.target,t.target.container?(i=t.target.container,l(t.target.container)):(t.target.editorContainer.parentElement.style.position="relative",i=t.target.editorContainer,l(t.target.editorContainer),r("div.tutor-chatgpt-bubble").css("bottom","35px"))}function d(t){var o,a;t.success||tutor_toast(n("Sorry!","tutor-pro"),t.data.message,"error"),t.success&&(r("input.tutor-chatgpt-input").val(""),t=t.data.text,o="","TEXTAREA"===i.nodeName?(o=""!==(null==(a=i.value)?void 0:a.trim())?"\n":"",i.value="".concat(i.value).concat(o).concat(t)):(o=""!==u.getContent({format:"text"}).trim()?"<br>":"",null!=(a=u)&&a.execCommand("mceInsertContent",!1,"".concat(o).concat(t))),r("#tutor-chatgpt-modal").removeClass("tutor-is-active"))}r("body").on("click",["textarea.wp-editor-area",'textarea[name="topic_summery"]','textarea[name="quiz_description"]','textarea[data-name="meeting_summary"]','textarea[name="meeting_summary"]'].join(","),function(t){i=t.target,l(t.target)}),null!=(t=tinymce.get("content"))&&t.on("focus",p),r("#content-tmce").click(function(){setTimeout(function(){l((u=tinymce.get("content")).container)},500)}),r("#content-html").click(function(){u=null,setTimeout(function(){l(i=document.querySelector("textarea.wp-editor-area"))},500)}),null!=(t=tinymce.get("course_description"))&&t.on("focus",p),window.addEventListener("tutor_modal_shown",function(){var t;null!=(t=tinymce.get("tutor_lesson_modal_editor"))&&t.on("focus",p),null!=(t=tinymce.get("tutor_quiz_desc_text_editor"))&&t.on("focus",p),null!=(t=tinymce.get("tutor_assignments_modal_editor"))&&t.on("focus",p)}),r("body").on("click","div.tutor-chatgpt-bubble",function(){"1"===_tutor_chatgpt.has_api_key?(r("#tutor-chatgpt-modal").addClass("tutor-is-active"),r('input[name="tutor-chatgpt-word-limit"]').val(""),setTimeout(function(){return r("textarea.tutor-chatgpt-input").val("").focus()})):(r("#tutor-chatgpt-api-key-modal").addClass("tutor-is-active"),setTimeout(function(){return r("input.tutor-chatgpt-api-key").val("").focus()}))}),r("body").on("click","#tutor-chatgpt-modal .tutor-modal-close",function(){r("#tutor-chatgpt-modal").removeClass("tutor-is-active")}),r("#tutor-chatgpt-modal .tutor-btn-submit").on("click",function(){var t=r("#tutor-chatgpt-modal .tutor-btn-submit"),o=r("textarea.tutor-chatgpt-input").val().trim(),a=r('input[name="tutor-chatgpt-word-limit"]').val();""!==o&&(0<parseInt(a)&&(o="".concat(o," in ").concat(a," words")),t.attr("disabled","disabled").addClass("is-loading"),r.ajax({url:_tutorobject.ajaxurl,method:"POST",dataType:"JSON",data:{prompt:o,action:"tutor_pro_chatgpt"},success:d,complete:function(){t.removeAttr("disabled").removeClass("is-loading")}}))}),r("#tutor-chatgpt-api-key-modal .tutor-btn-submit").on("click",function(t){var o=r("#tutor-chatgpt-api-key-modal .tutor-btn-submit"),a=r("input.tutor-chatgpt-api-key").val().trim(),e=r('input[name="tutor_pro_chatgpt_enable"]').is(":checked");""===a&&e?tutor_toast(n("Sorry!","tutor-pro"),n("API Key required","tutor-pro"),"error"):(o.attr("disabled","disabled").addClass("is-loading"),r.ajax({url:_tutorobject.ajaxurl,method:"POST",dataType:"JSON",data:{api_key:a,chatgpt_enable:e,action:"tutor_pro_chatgpt_save_settings"},success:function(t){t.success||tutor_toast(n("Sorry!","tutor-pro"),t.data.message,"error"),t.success&&(tutor_toast(n("Success!","tutor-pro"),t.data.message,"success"),e?(_tutor_chatgpt.has_api_key="1",r("#tutor-chatgpt-api-key-modal").removeClass("tutor-is-active"),r("#tutor-chatgpt-modal").addClass("tutor-is-active"),r("#tutor-chatgpt-modal textarea.tutor-chatgpt-input").val("").focus()):window.location.reload(!0))},complete:function(){o.removeAttr("disabled").removeClass("is-loading")}}))})});